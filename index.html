<!DOCTYPE html>
<html lang="hr">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <title>COPOS – Pregled vodostaja</title>
  <link rel="stylesheet" href="style.css" />

  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="theme-color" content="#0b1118">
</head>

<body>
  <div class="app">

    <header class="header">
      <div>
        <div class="header__title">CENTAR OBRANE OD POPLAVA – OSIJEK</div>
        <div class="header__subtitle">INFO PANEL</div>
      </div>

      <div class="clock" id="clock">--:--:--</div>
    </header>

    <main class="content content--no-padding">
      <iframe id="slideFrame" src="hidro.html?id=1" class="iframe--fullscreen" loading="eager"></iframe>
    </main>

    <footer class="footer">
      <div>Izvor: Hrvatske vode / DHMZ / SHMU / OVF</div>

      <div class="rotation">
        <button id="prevSlide" class="rotation__toggle" aria-label="Prethodni slajd" title="Prethodni slajd">
          <svg width="14" height="14" viewBox="0 0 14 14" fill="currentColor">
            <path d="M9 2L4 7L9 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"
              stroke-linejoin="round" fill="none" />
          </svg>
        </button>

        <button id="rotationToggle" class="rotation__toggle" aria-label="Pauziraj rotaciju" title="Pauziraj">
          <svg width="14" height="14" viewBox="0 0 14 14" fill="currentColor">
            <rect x="2" y="1" width="4" height="12" rx="1" />
            <rect x="8" y="1" width="4" height="12" rx="1" />
          </svg>
        </button>

        <button id="nextSlide" class="rotation__toggle" aria-label="Sljedeći slajd" title="Sljedeći slajd">
          <svg width="14" height="14" viewBox="0 0 14 14" fill="currentColor">
            <path d="M5 2L10 7L5 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"
              stroke-linejoin="round" fill="none" />
          </svg>
        </button>

        <span id="slideLabel">VODOTOK - POSTAJA</span>

        <div class="progress">
          <div class="progress__bar" id="progressBar"></div>
        </div>

        <span id="slideCounter">1 / 31</span>
      </div>
    </footer>

  </div>

  <script>
    /* ================================
       SAT
    ================================ */
    function updateClock() {
      document.getElementById("clock")
        .textContent = new Date().toLocaleTimeString("hr-HR");
    }
    updateClock();
    setInterval(updateClock, 1000);

    /* ================================
       ROTACIJA SLAJDOVA
    ================================ */
    const slides = [
      { src: "hidro.html?id=1", label: "VODOSTAJI - 1" },
      { src: "hidro.html?id=2", label: "VODOSTAJI - 2" },
      { src: "meteo.html?id=1", label: "Meteo Podaci - 1" },
      { src: "meteo.html?id=2", label: "Meteo Podaci - 2" },
      { src: "meteo.html?id=3", label: "Meteo Podaci - 3" },
      { src: "meteo.html?id=4", label: "Meteo Podaci - 4" },
      { src: "meteo.html?id=5", label: "Meteo Podaci - 5" },
      { src: "dionice.html?id=1", label: "Status Dionica - 1" },
      { src: "dionice.html?id=2", label: "Status Dionica - 2" },
      { src: "dionice.html?id=3", label: "Status Dionica - 3" },
      { src: "dionice.html?id=4", label: "Status Dionica - 4" },
      { src: "dionice.html?id=5", label: "Status Dionica - 5" },
      { src: "dionice.html?id=6", label: "Status Dionica - 6" },
      { src: "dionice.html?id=7", label: "Status Dionica - 7" },
      { src: "dionice.html?id=8", label: "Status Dionica - 8" },
      { src: "dionice.html?id=9", label: "Status Dionica - 9" },
      { src: "dionice.html?id=10", label: "Status Dionica - 10" },
      { src: "dionice.html?id=11", label: "Status Dionica - 11" },
      { src: "dionice.html?id=12", label: "Status Dionica - 12" },
      { src: "dionice.html?id=13", label: "Status Dionica - 13" },
      { src: "dionice.html?id=14", label: "Status Dionica - 14" },
      { src: "dionice.html?id=15", label: "Status Dionica - 15" },
      { src: "dionice.html?id=16", label: "Status Dionica - 16" },
      { src: "dionice.html?id=17", label: "Status Dionica - 17" },
      { src: "dionice.html?id=18", label: "Status Dionica - 18" },
      { src: "dionice.html?id=19", label: "Status Dionica - 19" },
      { src: "dionice.html?id=20", label: "Status Dionica - 20" },
      { src: "dionice.html?id=21", label: "Status Dionica - 21" },
      { src: "dionice.html?id=22", label: "Status Dionica - 22" },
      { src: "dionice.html?id=23", label: "Status Dionica - 23" },
      { src: "dionice.html?id=24", label: "Status Dionica - 24" },
      { src: "dionice.html?id=25", label: "Status Dionica - 25" },
      { src: "dionice.html?id=26", label: "Status Dionica - 26" }
    ];

    const rotationTime = 12000; // 12 sekundi
    let currentSlide = 0;
    let rotationInterval = null;
    let progressAnimationFrame = null;
    let isPaused = false;
    let progressStartTime = null;

    const frame = document.getElementById("slideFrame");
    const label = document.getElementById("slideLabel");
    const counter = document.getElementById("slideCounter");
    const bar = document.getElementById("progressBar");
    const toggleBtn = document.getElementById("rotationToggle");

    // SVG ikone
    const ICON_PAUSE = `
      <svg width="14" height="14" viewBox="0 0 14 14" fill="currentColor">
        <rect x="2" y="1" width="4" height="12" rx="1" />
        <rect x="8" y="1" width="4" height="12" rx="1" />
      </svg>`;

    const ICON_PLAY = `
      <svg width="14" height="14" viewBox="0 0 14 14" fill="currentColor" class="icon--offset">
        <path d="M3 2.5C3 1.6 4 1.1 4.8 1.6L12.3 6.1C13 6.5 13 7.5 12.3 7.9L4.8 12.4C4 12.9 3 12.4 3 11.5V2.5Z" />
      </svg>`;

    // Učitaj slajd
    function loadSlide(index) {
      currentSlide = index % slides.length;

      frame.src = slides[currentSlide].src;
      label.textContent = slides[currentSlide].label;
      counter.textContent = `${currentSlide + 1} / ${slides.length}`;

      // Resetiraj progress bar
      bar.style.transition = "none";
      bar.style.width = "0%";

      if (!isPaused) {
        void bar.offsetWidth; // Force reflow
        bar.style.transition = `width ${rotationTime}ms linear`;
        bar.style.width = "100%";
      }
    }

    // Sljedeći slajd
    function nextSlide() {
      loadSlide(currentSlide + 1);
    }

    // Prethodni slajd
    function previousSlide() {
      loadSlide(currentSlide - 1 + slides.length);
    }

    // Pokreni rotaciju
    function startRotation() {
      if (rotationInterval) clearInterval(rotationInterval);

      rotationInterval = setInterval(nextSlide, rotationTime);
      isPaused = false;

      toggleBtn.innerHTML = ICON_PAUSE;
      toggleBtn.setAttribute("aria-label", "Pauziraj rotaciju");
      toggleBtn.setAttribute("title", "Pauziraj");

      // Ponovno pokreni progress bar
      loadSlide(currentSlide);
    }

    // Zaustavi rotaciju
    function stopRotation() {
      if (rotationInterval) {
        clearInterval(rotationInterval);
        rotationInterval = null;
      }

      isPaused = true;

      toggleBtn.innerHTML = ICON_PLAY;
      toggleBtn.setAttribute("aria-label", "Pokreni rotaciju");
      toggleBtn.setAttribute("title", "Pokreni");

      // Zamrzni progress bar na trenutnoj poziciji
      const computedStyle = window.getComputedStyle(bar);
      const width = computedStyle.getPropertyValue('width');
      bar.style.transition = "none";
      bar.style.width = width;
    }

    // Toggle pauza/play
    function toggleRotation() {
      if (isPaused) {
        startRotation();
      } else {
        stopRotation();
      }
    }

    // Event listeneri
    toggleBtn.addEventListener("click", toggleRotation);

    document.getElementById("prevSlide").addEventListener("click", () => {
      previousSlide();
      if (!isPaused) {
        startRotation(); // Restartuj timer nakon ručne promjene
      }
    });

    document.getElementById("nextSlide").addEventListener("click", () => {
      nextSlide();
      if (!isPaused) {
        startRotation(); // Restartuj timer nakon ručne promjene
      }
    });

    // Keyboard shortcuts
    document.addEventListener("keydown", (e) => {
      if (e.key === "ArrowLeft") {
        previousSlide();
        if (!isPaused) startRotation();
      } else if (e.key === "ArrowRight") {
        nextSlide();
        if (!isPaused) startRotation();
      } else if (e.key === " " || e.key === "Spacebar") {
        e.preventDefault();
        toggleRotation();
      }
    });

    // Inicijalizacija
    loadSlide(0);
    startRotation();

    // Debugging info (može se ukloniti u produkciji)
    console.log(`Rotacija pokrenuta: ${slides.length} slajdova × ${rotationTime / 1000}s = ${(slides.length * rotationTime) / 60000} min`);
  </script>

</body>

</html>